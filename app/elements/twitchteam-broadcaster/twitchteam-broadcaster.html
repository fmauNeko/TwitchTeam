<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-icon/core-icon.html">
<link rel="import" href="../../bower_components/core-icons/av-icons.html">
<link rel="import" href="../../bower_components/core-icons/social-icons.html">
<link rel="import" href="../../bower_components/paper-ripple/paper-ripple.html">

<link href="twitchteam-broadcaster.css" rel="stylesheet">

<polymer-element name="twitchteam-broadcaster" attributes="broadcaster" center horizontal layout>

  <template>
    <paper-ripple id="ripple"></paper-ripple>

    <img id="avatar" src="{{avatar}}" self-start/>
    <div id="infos" self-start vertical around-justified layout center>
      <div id="broadcasterName">{{displayName}}</div>
      <div id="game">playing {{game}}</div>
      <div id="status">{{status}}</div>
    </div>
    <div id="live" live?="{{live}}" horizontal justified layout center>
      <div class="well"><core-icon icon="{{live ? 'check-circle-blank' : 'av:stop'}}" red?="{{live}}"></core-icon><span class="count">{{live ? 'LIVE' : 'OFFLINE'}}</span></div>
      <div flex></div>
      <div class="well" margin><core-icon icon="social:person" red></core-icon><span class="count">{{viewers}}</span></div>
      <div class="well" margin><core-icon icon="visibility"></core-icon><span class="count">{{views}}</span></div>
      <div class="well"><core-icon icon="favorite"></core-icon><span class="count">{{followers}}</span></div>
    </div>
  </template>

  <script>
    (function () {
      'use strict';

      Polymer({
        avatar: '',
        broadcaster: '',
        displayName: '',
        followers: 0,
        game: '',
        live: false,
        status: '',
        viewers: 0,
        views: 0,

        ready: function(){
          twitchThing.warehouse.RegisterObserver({
            New: this.updateStatus.bind(this),
            Deleted: function(){},
            Updated: this.updateStatus.bind(this),
            Define: function(){}
          });
        },

        eventDelegates: {
          'down': 'downAction',
          'up': 'upAction'
        },

        downAction: function(e) {
          this.$.ripple.downAction(e);
        },

        upAction: function(e) {
          this.$.ripple.upAction(e);
        },

        updateStatus: function(thing){
          if (thing.ID == this.broadcaster){
            this.avatar = thing.String("avatar");
            this.broadcaster = thing.String("broadcaster");
            this.displayName = thing.String("displayName");
            this.followers = thing.Int("followers");
            this.game = thing.String("game");
            this.live = thing.Boolean("live");
            this.status = thing.String("status");
            this.viewers = thing.Int("viewers");
            this.views = thing.Int("views");
          }
        }
      });

    })();
  </script>
</polymer-element>
