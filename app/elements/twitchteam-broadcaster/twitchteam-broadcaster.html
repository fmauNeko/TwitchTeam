<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-icon/core-icon.html">
<link rel="import" href="../../bower_components/core-icons/social-icons.html">
<link rel="import" href="../../bower_components/paper-ripple/paper-ripple.html">

<link href="twitchteam-broadcaster.css" rel="stylesheet">

<polymer-element name="twitchteam-broadcaster" attributes="broadcaster" center horizontal layout>

  <template>
    <paper-ripple id="ripple"></paper-ripple>

    <img id="avatar" src="{{avatar}}" self-start/>
    <div id="infos" self-start vertical around-justified layout center>
      <div id="broadcasterName">{{displayName}}</div>
      <div id="game">playing {{game}}</div>
      <div id="status">{{status}}</div>
    </div>
    <div id="live" live?="{{live}}" horizontal justified layout center>
      <div>{{live ? 'LIVE' : 'OFFLINE'}}</div>
      <div flex></div>
      <core-icon icon="social:person" style="color: #b71c1c;"></core-icon>
      <div class="count">{{viewers}}</div>
      <core-icon icon="visibility"></core-icon>
      <div class="count">{{views}}</div>
      <core-icon icon="favorite"></core-icon>
      <div class="count">{{followers}}</div>
    </div>
  </template>

  <script>
    (function () {
      'use strict';

      Polymer({
        avatar: 'http://static-cdn.jtvnw.net/jtv_user_pictures/fmaunier-profile_image-80afe6408e865a9b-300x300.png',
        broadcaster: '',
        displayName: 'Jean-Roger',
        followers: '504',
        game: 'Ittle Dew',
        live: false,
        status: '[FR/EN] Ittle Dew Any% Speedruns',
        viewers: '25',
        views: '15300',

        ready: function(){
          twitchThing.warehouse.RegisterObserver({
            New: this.updateStatus.bind(this),
            Deleted: function(){},
            Updated: this.updateStatus.bind(this),
            Define: function(){}
          });
        },

        eventDelegates: {
          'down': 'downAction',
          'up': 'upAction'
        },

        downAction: function(e) {
          this.$.ripple.downAction(e);
        },

        upAction: function(e) {
          this.$.ripple.upAction(e);
        },

        updateStatus: function(thing){
          if (thing.ID == this.broadcaster){
            this.live = thing.Boolean("live");
          }
        }
      });

    })();
  </script>
</polymer-element>
